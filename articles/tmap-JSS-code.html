<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>tmap: JSS article reproduction code â€¢ tmap</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="tmap: JSS article reproduction code">
<meta property="og:description" content="tmap">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">tmap</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">3.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/tmap-JSS-code.html">tmap: JSS article reproduction code</a>
    </li>
    <li>
      <a href="../articles/tmap-changes.html">tmap: version changes</a>
    </li>
    <li>
      <a href="../articles/tmap-getstarted.html">tmap: get started!</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/mtennekes/tmap/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="tmap-JSS-code_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>tmap: JSS article reproduction code</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/mtennekes/tmap/blob/master/vignettes/tmap-JSS-code.Rmd"><code>vignettes/tmap-JSS-code.Rmd</code></a></small>
      <div class="hidden name"><code>tmap-JSS-code.Rmd</code></div>

    </div>

    
    
<div id="introduction" class="section level3">
<h3 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h3>
<p>The article <em>Tennekes, M. tmap: Thematic Maps in R (2018), Journal of Statistical Software 84(6), 1-39,</em> <a href="http://dx.doi.org/10.18637/jss.v084.i06" class="uri">http://dx.doi.org/10.18637/jss.v084.i06</a> describes version 1.x of tmap and tmaptools. Since tmap and tmaptools version 2.0 are based on <code>sf</code> objects instead of <code>sp</code> objects, there are some changes in the code, especially regarding the necessary processing step. The code for the plotting methods is fully backward compatible, although some messages or warnings may be given for deprecated functions or arguments.</p>
<p>This code replaces the script v84i06.R for tmap and tmaptools version 2.0. The produced figures are identical to those included in the article.</p>
<p>See <a href="../doc/tmap-changes.html"><code>vignette("tmap-changes")</code></a> for changes in version 2.x/3.x, which is recommended for people who have read the JSS article. For people who are new to tmap, see <a href="../doc/tmap-getstarted.html"><code>vignette("tmap-getstarted")</code></a>.</p>
<div class="sourceCode" id="cb1"><pre class="downlit">
<span class="co">###########################################################################</span>
<span class="co">## This script will replicate the figures (except the screenshots)</span>
<span class="co">## and write them to files.</span>
<span class="co">## The working directory should be set the the parent folder of this script.</span>
<span class="co">###########################################################################</span>

<span class="co">## install.packages(c("tmap", "tmaptools"))</span>
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="st"><a href="https://github.com/mtennekes/tmap">"tmap"</a></span>) <span class="co"># required version 2.0 or later</span>
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="st"><a href="https://github.com/mtennekes/tmaptools">"tmaptools"</a></span>) <span class="co"># required version 2.0 or later</span>

<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span>(<span class="st">"World"</span>, <span class="st">"metro"</span>, package = <span class="st">"tmap"</span>)
<span class="kw">metro</span><span class="op">$</span><span class="kw">growth</span> <span class="op">&lt;-</span> (<span class="kw">metro</span><span class="op">$</span><span class="kw">pop2020</span> <span class="op">-</span> <span class="kw">metro</span><span class="op">$</span><span class="kw">pop2010</span>) <span class="op">/</span> (<span class="kw">metro</span><span class="op">$</span><span class="kw">pop2010</span> <span class="op">*</span> <span class="fl">10</span>) <span class="op">*</span> <span class="fl">100</span>
</pre></div>
</div>
<div id="section-1-1" class="section level3">
<h3 class="hasAnchor">
<a href="#section-1-1" class="anchor"></a>Section 1.1</h3>
<div class="sourceCode" id="cb2"><pre class="downlit">
<span class="co">#############################</span>
<span class="co">## Figure 1</span>
<span class="co">#############################</span>

<span class="kw">m1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tm_shape.html">tm_shape</a></span>(<span class="kw">World</span>) <span class="op">+</span>
    <span class="fu"><a href="../reference/tm_fill.html">tm_polygons</a></span>(<span class="st">"income_grp"</span>, palette = <span class="st">"-Blues"</span>, 
      title = <span class="st">"Income class"</span>, contrast = <span class="fl">0.7</span>, border.col = <span class="st">"grey30"</span>, id = <span class="st">"name"</span>) <span class="op">+</span>
    <span class="fu"><a href="../reference/tm_text.html">tm_text</a></span>(<span class="st">"iso_a3"</span>, size = <span class="st">"AREA"</span>, col = <span class="st">"grey30"</span>, root = <span class="fl">3</span>) <span class="op">+</span>
  <span class="fu"><a href="../reference/tm_shape.html">tm_shape</a></span>(<span class="kw">metro</span>) <span class="op">+</span>
    <span class="fu"><a href="../reference/tm_symbols.html">tm_bubbles</a></span>(<span class="st">"pop2010"</span>, col = <span class="st">"growth"</span>, border.col = <span class="st">"black"</span>,
      border.alpha = <span class="fl">0.5</span>,
      breaks = <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="op">-</span><span class="fl">Inf</span>, <span class="fl">0</span>, <span class="fl">2</span>, <span class="fl">4</span>, <span class="fl">6</span>, <span class="fl">Inf</span>) ,
      palette = <span class="st">"-RdYlGn"</span>,
      title.size = <span class="st">"Metro population (2010)"</span>, 
      title.col = <span class="st">"Annual growth rate (%)"</span>,
      id = <span class="st">"name"</span>,
      popup.vars = <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"pop2010"</span>, <span class="st">"pop2020"</span>, <span class="st">"growth"</span>)) <span class="op">+</span> 
  <span class="fu"><a href="../reference/tm_layout.html">tm_style</a></span>(<span class="st">"gray"</span>) <span class="op">+</span>
  <span class="fu"><a href="../reference/tm_layout.html">tm_format</a></span>(<span class="st">"World"</span>, frame.lwd = <span class="fl">2</span>)
<span class="fu"><a href="../reference/tmap_save.html">tmap_save</a></span>(<span class="kw">m1</span>, <span class="st">"bubble.png"</span>, width = <span class="fl">6.125</span>, height = <span class="fl">3</span>, scale = <span class="fl">.75</span>, dpi = <span class="fl">300</span>, asp = <span class="fl">0</span>, outer.margins = <span class="fl">0</span>)
</pre></div>
</div>
<div id="section-3-1" class="section level3">
<h3 class="hasAnchor">
<a href="#section-3-1" class="anchor"></a>Section 3.1</h3>
<div class="sourceCode" id="cb3"><pre class="downlit">
<span class="co">#############################</span>
<span class="co">## Figure 2</span>
<span class="co">#############################</span>

<span class="kw">m0</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tm_shape.html">tm_shape</a></span>(<span class="kw">metro</span>) <span class="op">+</span> 
  <span class="fu"><a href="../reference/tm_symbols.html">tm_bubbles</a></span>(size = <span class="st">"pop2030"</span>) <span class="op">+</span>
  <span class="fu"><a href="../reference/tm_layout.html">tm_style</a></span>(<span class="st">"cobalt"</span>) <span class="op">+</span>
  <span class="fu"><a href="../reference/tm_layout.html">tm_format</a></span>(<span class="st">"World"</span>)
<span class="fu"><a href="../reference/tmap_save.html">tmap_save</a></span>(<span class="kw">m0</span>, <span class="st">"metro2030.png"</span>, width = <span class="fl">6.125</span>, scale = <span class="fl">.5</span>, dpi = <span class="fl">300</span>, outer.margins = <span class="fl">0</span>)
</pre></div>
</div>
<div id="section-3-2" class="section level3">
<h3 class="hasAnchor">
<a href="#section-3-2" class="anchor"></a>Section 3.2</h3>
<div class="sourceCode" id="cb4"><pre class="downlit">
<span class="co">#############################</span>
<span class="co">## Figure 3</span>
<span class="co">#############################</span>
<span class="kw">m21</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tm_shape.html">tm_shape</a></span>(<span class="kw">World</span>) <span class="op">+</span> <span class="fu"><a href="../reference/tm_fill.html">tm_polygons</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"blue"</span>, <span class="st">"red"</span>)) <span class="op">+</span> <span class="fu"><a href="../reference/tm_layout.html">tm_layout</a></span>(frame.lwd = <span class="fl">1.5</span>)
<span class="fu"><a href="../reference/tmap_save.html">tmap_save</a></span>(<span class="kw">m21</span>, <span class="st">"facets1.png"</span>, width = <span class="fl">6.125</span>, height = <span class="fl">1.54</span>, scale = <span class="fl">.75</span>, dpi = <span class="fl">300</span>, outer.margins = <span class="fl">0</span>)
</pre></div>
<div class="sourceCode" id="cb5"><pre class="downlit">
<span class="co">#############################</span>
<span class="co">## Figure 4</span>
<span class="co">#############################</span>
<span class="kw">m22</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tm_shape.html">tm_shape</a></span>(<span class="kw">World</span>) <span class="op">+</span> <span class="fu"><a href="../reference/tm_fill.html">tm_polygons</a></span>(<span class="st">"red"</span>) <span class="op">+</span> <span class="fu"><a href="../reference/tm_facets.html">tm_facets</a></span>(by = <span class="st">"continent"</span>, free.coords = <span class="fl">FALSE</span>)
<span class="fu"><a href="../reference/tmap_save.html">tmap_save</a></span>(<span class="kw">m22</span>, <span class="st">"facets2.png"</span>, width = <span class="fl">6.125</span>, height = <span class="fl">1.8</span>, scale = <span class="fl">.75</span>, dpi = <span class="fl">300</span>, outer.margins = <span class="fl">0</span>)
</pre></div>
<div class="sourceCode" id="cb6"><pre class="downlit">
<span class="co">#############################</span>
<span class="co">## Figure 5</span>
<span class="co">#############################</span>
<span class="kw">tm1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tm_shape.html">tm_shape</a></span>(<span class="kw">World</span>) <span class="op">+</span> <span class="fu"><a href="../reference/tm_fill.html">tm_polygons</a></span>()
<span class="kw">tm2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tm_shape.html">tm_shape</a></span>(<span class="kw">metro</span>) <span class="op">+</span> <span class="fu"><a href="../reference/tm_symbols.html">tm_dots</a></span>()
<span class="fu"><a href="https://rdrr.io/r/grDevices/png.html">png</a></span>(<span class="st">"facets3.png"</span>, width = <span class="fl">6.125</span>, height = <span class="fl">1.54</span>, units = <span class="st">"in"</span>, res = <span class="fl">300</span>)
  <span class="fu"><a href="../reference/tmap_arrange.html">tmap_arrange</a></span>(<span class="kw">tm1</span>, <span class="kw">tm2</span>, outer.margins = <span class="fl">.01</span>)
<span class="fu"><a href="https://rdrr.io/r/grDevices/dev.html">dev.off</a></span>()
</pre></div>
</div>
<div id="section-4-1" class="section level3">
<h3 class="hasAnchor">
<a href="#section-4-1" class="anchor"></a>Section 4.1</h3>
<div class="sourceCode" id="cb7"><pre class="downlit">
<span class="co">#############################</span>
<span class="co">## Figure 6</span>
<span class="co">#############################</span>

<span class="fu"><a href="../reference/tmap_mode.html">tmap_mode</a></span>(<span class="st">"view"</span>)
<span class="kw">m1</span>
</pre></div>
</div>
<div id="section-4-2" class="section level3">
<h3 class="hasAnchor">
<a href="#section-4-2" class="anchor"></a>Section 4.2</h3>
<div class="sourceCode" id="cb8"><pre class="downlit">
<span class="co">#############################</span>
<span class="co">## Figure 7</span>
<span class="co">#############################</span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span>(<span class="st">"land"</span>, <span class="st">"rivers"</span>, package = <span class="st">"tmap"</span>)
<span class="kw">m2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tm_shape.html">tm_shape</a></span>(<span class="kw">land</span>) <span class="op">+</span>
  <span class="fu"><a href="../reference/tm_raster.html">tm_raster</a></span>(<span class="st">"elevation"</span>, breaks = <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="op">-</span><span class="fl">Inf</span>, <span class="fl">250</span>, <span class="fl">500</span>, <span class="fl">1000</span>, <span class="fl">1500</span>, <span class="fl">2000</span>, <span class="fl">2500</span>, <span class="fl">3000</span>, <span class="fl">4000</span>, <span class="fl">Inf</span>),  
            palette = <span class="fu"><a href="https://rdrr.io/r/grDevices/palettes.html">terrain.colors</a></span>(<span class="fl">9</span>), title = <span class="st">"Elevation (m)"</span>) <span class="op">+</span>
  <span class="fu"><a href="../reference/tm_shape.html">tm_shape</a></span>(<span class="kw">rivers</span>) <span class="op">+</span> 
  <span class="fu"><a href="../reference/tm_lines.html">tm_lines</a></span>(<span class="st">"lightblue"</span>, lwd = <span class="st">"strokelwd"</span>, scale = <span class="fl">1.5</span>, legend.lwd.show = <span class="fl">FALSE</span>) <span class="op">+</span>
  <span class="fu"><a href="../reference/tm_shape.html">tm_shape</a></span>(<span class="kw">World</span>, is.master = <span class="fl">TRUE</span>) <span class="op">+</span>
  <span class="fu"><a href="../reference/tm_fill.html">tm_borders</a></span>(<span class="st">"grey20"</span>, lwd = <span class="fl">.5</span>) <span class="op">+</span>
  <span class="fu"><a href="../reference/tm_grid.html">tm_grid</a></span>(projection = <span class="st">"longlat"</span>, labels.size = <span class="fl">0.4</span>, lwd = <span class="fl">0.25</span>) <span class="op">+</span>
  <span class="fu"><a href="../reference/tm_text.html">tm_text</a></span>(<span class="st">"name"</span>, size = <span class="st">"AREA"</span>) <span class="op">+</span>
  <span class="fu"><a href="../reference/tm_compass.html">tm_compass</a></span>(position = <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0.08</span>, <span class="fl">0.45</span>), color.light = <span class="st">"grey90"</span>, size = <span class="fl">3</span>) <span class="op">+</span>
  <span class="fu"><a href="../reference/tm_credits.html">tm_credits</a></span>(<span class="st">"Eckert IV projection"</span>, position = <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"RIGHT"</span>, <span class="st">"BOTTOM"</span>)) <span class="op">+</span>
  <span class="fu"><a href="../reference/tm_layout.html">tm_style</a></span>(<span class="st">"classic"</span>,
         bg.color = <span class="st">"lightblue"</span>,
         space.color = <span class="st">"grey90"</span>,
         inner.margins = <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0.04</span>, <span class="fl">0.04</span>, <span class="fl">0.03</span>, <span class="fl">0.02</span>), 
         earth.boundary = <span class="fl">TRUE</span>) <span class="op">+</span>
  <span class="fu"><a href="../reference/tm_layout.html">tm_legend</a></span>(position = <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"left"</span>, <span class="st">"bottom"</span>), 
            frame = <span class="fl">TRUE</span>,
            bg.color = <span class="st">"lightblue"</span>)
<span class="fu"><a href="../reference/tmap_save.html">tmap_save</a></span>(<span class="kw">m2</span>, <span class="st">"classic.png"</span>, width = <span class="fl">6.125</span>, scale = <span class="fl">.7</span>, dpi = <span class="fl">300</span>, outer.margins = <span class="fl">0</span>)
</pre></div>
</div>
<div id="section-4-3" class="section level3">
<h3 class="hasAnchor">
<a href="#section-4-3" class="anchor"></a>Section 4.3</h3>
<div class="sourceCode" id="cb9"><pre class="downlit">
<span class="co">#############################</span>
<span class="co">## Figure 8</span>
<span class="co">#############################</span>
<span class="kw">m3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tm_shape.html">tm_shape</a></span>(<span class="kw">World</span>, projection = <span class="st">"robin"</span>) <span class="op">+</span>
  <span class="fu"><a href="../reference/tm_fill.html">tm_polygons</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"HPI"</span>, <span class="st">"gdp_cap_est"</span>),
              palette = <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="st">"RdYlGn"</span>, <span class="st">"Purples"</span>),
              style = <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"pretty"</span>, <span class="st">"fixed"</span>), n = <span class="fl">7</span>, 
              breaks = <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">NULL</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0</span>, <span class="fl">500</span>, <span class="fl">2000</span>, <span class="fl">5000</span>, <span class="fl">10000</span>, <span class="fl">25000</span>, <span class="fl">50000</span>, <span class="fl">Inf</span>)),
              title = <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"Happy Planet Index"</span>, <span class="st">"GDP per capita"</span>)) <span class="op">+</span>
  <span class="fu"><a href="../reference/tm_layout.html">tm_style</a></span>(<span class="st">"natural"</span>, earth.boundary = <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="op">-</span><span class="fl">180</span>, <span class="op">-</span><span class="fl">87</span>, <span class="fl">180</span>, <span class="fl">87</span>))  <span class="op">+</span>
  <span class="fu"><a href="../reference/tm_layout.html">tm_format</a></span>(<span class="st">"World"</span>, inner.margins = <span class="fl">0.02</span>, frame = <span class="fl">FALSE</span>) <span class="op">+</span>
  <span class="fu"><a href="../reference/tm_layout.html">tm_legend</a></span>(position = <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"left"</span>, <span class="st">"bottom"</span>), bg.color = <span class="st">"gray95"</span>, frame = <span class="fl">TRUE</span>) <span class="op">+</span>
  <span class="fu"><a href="../reference/tm_credits.html">tm_credits</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">""</span>, <span class="st">"Robinson projection"</span>), position = <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"RIGHT"</span>, <span class="st">"BOTTOM"</span>))
  
<span class="fu"><a href="../reference/tmap_save.html">tmap_save</a></span>(<span class="kw">m3</span>, <span class="st">"world_facets2.png"</span>, width = <span class="fl">5</span>, scale = <span class="fl">.7</span>, dpi = <span class="fl">300</span>, outer.margins = <span class="fl">0</span>)
</pre></div>
</div>
<div id="section-4-4" class="section level3">
<h3 class="hasAnchor">
<a href="#section-4-4" class="anchor"></a>Section 4.4</h3>
<div class="sourceCode" id="cb10"><pre class="downlit">
<span class="co">#############################</span>
<span class="co">## Figure 9</span>
<span class="co">#############################</span>
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="st">"readxl"</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="st">"grid"</span>)

<span class="co"># function to obtain Food Environment Atlas data (2014)</span>
<span class="kw">get_food_envir_data</span> <span class="op">&lt;-</span> <span class="fu">function</span>() {
  <span class="kw">dir</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html">tempdir</a></span>()
  <span class="co">if</span> (<span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/files.html">file.exists</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span>(<span class="kw">dir</span>, <span class="st">"DataDownload.xls"</span>))) {
    <span class="fu"><a href="https://rdrr.io/r/utils/download.file.html">download.file</a></span>(<span class="st">"https://www.ers.usda.gov/webdocs/DataFiles/48731/February2014.xls?v=41688"</span>, destfile = <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span>(<span class="kw">dir</span>, <span class="st">"DataDownload.xls"</span>), mode = <span class="st">"wb"</span>)
  }
  <span class="kw">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/conditions.html">tryCatch</a></span>({
    <span class="fu">read_excel</span>(<span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span>(<span class="kw">dir</span>, <span class="st">"DataDownload.xls"</span>), sheet = <span class="st">"HEALTH"</span>)    
  }, error = <span class="fu">function</span>(<span class="kw">e</span>) {
    <span class="fu"><a href="https://rdrr.io/r/base/stop.html">stop</a></span>(<span class="st">"The excel file cannot be read. Please open it, and remove all sheets except HEALTH. The location of the file is: "</span>, <span class="fu"><a href="https://rdrr.io/r/base/normalizePath.html">normalizePath</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span>(<span class="kw">dir</span>, <span class="st">"DataDownload.xls"</span>)))
  })
}

<span class="co"># function to obtain US county shape</span>
<span class="kw">get_US_county_2010_shape</span> <span class="op">&lt;-</span> <span class="fu">function</span>() {
  <span class="kw">dir</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html">tempdir</a></span>()
  <span class="fu"><a href="https://rdrr.io/r/utils/download.file.html">download.file</a></span>(<span class="st">"http://www2.census.gov/geo/tiger/GENZ2010/gz_2010_us_050_00_20m.zip"</span>, destfile = <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span>(<span class="kw">dir</span>, <span class="st">"gz_2010_us_050_00_20m.zip"</span>))
  <span class="fu"><a href="https://rdrr.io/r/utils/unzip.html">unzip</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span>(<span class="kw">dir</span>, <span class="st">"gz_2010_us_050_00_20m.zip"</span>), exdir = <span class="kw">dir</span>)
  <span class="kw">US</span> <span class="op">&lt;-</span> <span class="kw">sf</span>::<span class="fu"><a href="https://rdrr.io/pkg/sf/man/st_read.html">read_sf</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span>(<span class="kw">dir</span>, <span class="st">"gz_2010_us_050_00_20m.shp"</span>))
  <span class="fu"><a href="https://rdrr.io/r/base/levels.html">levels</a></span>(<span class="kw">US</span><span class="op">$</span><span class="kw">NAME</span>) <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/iconv.html">iconv</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/levels.html">levels</a></span>(<span class="kw">US</span><span class="op">$</span><span class="kw">NAME</span>), from = <span class="st">"latin1"</span>, to = <span class="st">"utf8"</span>)
  <span class="kw">US</span>
}

<span class="co"># obtain Food Environment Atlas data</span>
<span class="kw">FEA</span> <span class="op">&lt;-</span> <span class="fu">get_food_envir_data</span>()

<span class="co"># obtain US county shape</span>
<span class="kw">US</span> <span class="op">&lt;-</span> <span class="fu">get_US_county_2010_shape</span>()

<span class="kw">us1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/qtm.html">qtm</a></span>(<span class="kw">US</span>)

<span class="fu"><a href="../reference/tmap_save.html">tmap_save</a></span>(<span class="kw">us1</span>, <span class="st">"US1.png"</span>, scale = <span class="fl">.5</span>, width = <span class="fl">6.125</span>, asp = <span class="fl">0</span>, outer.margins = <span class="fl">0</span>)

<span class="co">#############################</span>
<span class="co">## Figure 10</span>
<span class="co">#############################</span>
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="kw"><a href="https://dplyr.tidyverse.org">dplyr</a></span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="kw"><a href="https://r-spatial.github.io/sf">sf</a></span>)

<span class="kw">US</span><span class="op">$</span><span class="kw">FIPS</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="kw">US</span><span class="op">$</span><span class="kw">STATE</span>, <span class="kw">US</span><span class="op">$</span><span class="kw">COUNTY</span>)

<span class="co"># append data to shape</span>
<span class="co">#US &lt;- append_data(US, FEA, key.shp = "FIPS", key.data = "FIPS", ignore.duplicates = TRUE)</span>
<span class="kw">US</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span>(<span class="kw">US</span>, <span class="kw">FEA</span>, by = <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"FIPS"</span>, <span class="st">"FIPS"</span>))


<span class="kw">unmatched_data</span> <span class="op">&lt;-</span> <span class="kw">FEA</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(<span class="op">!</span>(<span class="kw">FIPS</span> <span class="op">%in%</span> <span class="kw">US</span><span class="op">$</span><span class="kw">FIPS</span>))

<span class="fu"><a href="../reference/tmap_mode.html">tmap_mode</a></span>(<span class="st">"view"</span>)
<span class="fu"><a href="../reference/qtm.html">qtm</a></span>(<span class="kw">US</span>, fill = <span class="st">"PCT_OBESE_ADULTS10"</span>)
</pre></div>
<div class="sourceCode" id="cb11"><pre class="downlit">
<span class="co">#############################</span>
<span class="co">## Figure 11</span>
<span class="co">#############################</span>
<span class="kw">US_cont</span> <span class="op">&lt;-</span> <span class="kw">US</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span>(<span class="op">!</span><span class="kw">STATE</span> <span class="op">%in%</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"02"</span>, <span class="st">"15"</span>, <span class="st">"72"</span>)) <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rdrr.io/pkg/tmaptools/man/simplify_shape.html">simplify_shape</a></span>(<span class="fl">0.2</span>) 

<span class="kw">US_AK</span> <span class="op">&lt;-</span> <span class="kw">US</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span>(<span class="kw">STATE</span> <span class="op">==</span> <span class="st">"02"</span>) <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rdrr.io/pkg/tmaptools/man/simplify_shape.html">simplify_shape</a></span>(<span class="fl">0.2</span>) 

<span class="kw">US_HI</span> <span class="op">&lt;-</span> <span class="kw">US</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span>(<span class="kw">STATE</span> <span class="op">==</span> <span class="st">"15"</span>) <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rdrr.io/pkg/tmaptools/man/simplify_shape.html">simplify_shape</a></span>(<span class="fl">0.2</span>) 

<span class="co"># create state boundaries</span>
<span class="kw">US_states</span> <span class="op">&lt;-</span> <span class="kw">US_cont</span> <span class="op">%&gt;%</span> 
    <span class="kw">dplyr</span>::<span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(<span class="kw">geometry</span>) <span class="op">%&gt;%</span> 
    <span class="fu"><a href="https://rdrr.io/pkg/sf/man/aggregate.sf.html">aggregate</a></span>(by = <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">US_cont</span><span class="op">$</span><span class="kw">STATE</span>), FUN = <span class="kw">mean</span>)


<span class="co"># contiguous US</span>
<span class="kw">m_cont</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tm_shape.html">tm_shape</a></span>(<span class="kw">US_cont</span>, projection = <span class="fl">2163</span>) <span class="op">+</span>
  <span class="fu"><a href="../reference/tm_fill.html">tm_polygons</a></span>(<span class="st">"PCT_OBESE_ADULTS10"</span>, border.col = <span class="st">"gray50"</span>, border.alpha = <span class="fl">.5</span>, title = <span class="st">""</span>, showNA = <span class="fl">TRUE</span>) <span class="op">+</span>
  <span class="fu"><a href="../reference/tm_shape.html">tm_shape</a></span>(<span class="kw">US_states</span>) <span class="op">+</span>
  <span class="fu"><a href="../reference/tm_fill.html">tm_borders</a></span>(lwd = <span class="fl">1</span>, col = <span class="st">"black"</span>, alpha = <span class="fl">.5</span>) <span class="op">+</span>
  <span class="fu"><a href="../reference/tm_credits.html">tm_credits</a></span>(<span class="st">"Data @ Unites States Department of Agriculture\nShape @ Unites States Census Bureau"</span>, position = <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"right"</span>, <span class="st">"bottom"</span>)) <span class="op">+</span>
  <span class="fu"><a href="../reference/tm_layout.html">tm_layout</a></span>(title = <span class="st">"2010 Adult Obesity by County, percent"</span>, 
            title.position = <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"center"</span>, <span class="st">"top"</span>), 
            legend.position = <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"right"</span>, <span class="st">"bottom"</span>), 
            frame = <span class="fl">FALSE</span>, 
            inner.margins = <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0.1</span>, <span class="fl">0.1</span>, <span class="fl">0.05</span>, <span class="fl">0.05</span>))

<span class="co"># Alaska inset</span>
<span class="kw">m_AK</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tm_shape.html">tm_shape</a></span>(<span class="kw">US_AK</span>, projection = <span class="fl">3338</span>) <span class="op">+</span>
  <span class="fu"><a href="../reference/tm_fill.html">tm_polygons</a></span>(<span class="st">"PCT_OBESE_ADULTS10"</span>, border.col = <span class="st">"gray50"</span>, border.alpha = <span class="fl">.5</span>, breaks = <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(<span class="fl">10</span>, <span class="fl">50</span>, by = <span class="fl">5</span>)) <span class="op">+</span>
  <span class="fu"><a href="../reference/tm_layout.html">tm_layout</a></span>(<span class="st">"Alaska"</span>, legend.show = <span class="fl">FALSE</span>, bg.color = <span class="fl">NA</span>, title.size = <span class="fl">0.8</span>, frame = <span class="fl">FALSE</span>)

<span class="co"># Hawaii inset</span>
<span class="kw">m_HI</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tm_shape.html">tm_shape</a></span>(<span class="kw">US_HI</span>, projection = <span class="fl">3759</span>) <span class="op">+</span>
  <span class="fu"><a href="../reference/tm_fill.html">tm_polygons</a></span>(<span class="st">"PCT_OBESE_ADULTS10"</span>, border.col = <span class="st">"gray50"</span>, border.alpha = <span class="fl">.5</span>, breaks = <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(<span class="fl">10</span>, <span class="fl">50</span>, by = <span class="fl">5</span>)) <span class="op">+</span>
  <span class="fu"><a href="../reference/tm_layout.html">tm_layout</a></span>(<span class="st">"Hawaii"</span>, legend.show = <span class="fl">FALSE</span>, bg.color = <span class="fl">NA</span>, title.position = <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"LEFT"</span>, <span class="st">"BOTTOM"</span>), title.size = <span class="fl">0.8</span>, frame = <span class="fl">FALSE</span>)

<span class="co"># specify viewports for Alaska and Hawaii</span>
<span class="kw">vp_AK</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/grid/viewport.html">viewport</a></span>(x = <span class="fl">0.15</span>, y = <span class="fl">0.15</span>, width = <span class="fl">0.3</span>, height = <span class="fl">0.3</span>)
<span class="kw">vp_HI</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/grid/viewport.html">viewport</a></span>(x = <span class="fl">0.4</span>, y = <span class="fl">0.1</span>, width = <span class="fl">0.2</span>, height = <span class="fl">0.1</span>)

<span class="co"># save map</span>
<span class="fu"><a href="../reference/tmap_mode.html">tmap_mode</a></span>(<span class="st">"plot"</span>)
<span class="fu"><a href="../reference/tmap_save.html">tmap_save</a></span>(<span class="kw">m_cont</span>, <span class="st">"USchoro.png"</span>, scale = <span class="fl">0.7</span>, width = <span class="fl">6.125</span>, outer.margins = <span class="fl">0</span>,
          insets_tm = <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">m_AK</span>, <span class="kw">m_HI</span>), 
          insets_vp = <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">vp_AK</span>, <span class="kw">vp_HI</span>))
</pre></div>
</div>
<div id="section-4-5" class="section level3">
<h3 class="hasAnchor">
<a href="#section-4-5" class="anchor"></a>Section 4.5</h3>
<div class="sourceCode" id="cb12"><pre class="downlit">
<span class="co">#############################</span>
<span class="co">## Figure 12a</span>
<span class="co">#############################</span>
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="st"><a href="https://r-spatial.github.io/sf">"sf"</a></span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="st">"rnaturalearth"</span>)

<span class="co"># functions to obtain crimes data</span>
<span class="kw">get_crimes_data</span> <span class="op">&lt;-</span> <span class="fu">function</span>(<span class="kw">path</span>) {
  <span class="fu"><a href="https://rdrr.io/r/base/stopifnot.html">stopifnot</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/files.html">file.exists</a></span>(<span class="kw">path</span>), (<span class="st">"crimes_in_Greater_London_2015-10.zip"</span> <span class="op">%in%</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html">list.files</a></span>(<span class="kw">path</span>)))
  <span class="kw">tmp_dir</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html">tempdir</a></span>()
  <span class="fu"><a href="https://rdrr.io/r/utils/unzip.html">unzip</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span>(<span class="kw">path</span>, <span class="st">"crimes_in_Greater_London_2015-10.zip"</span>), exdir = <span class="kw">tmp_dir</span>)
  <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span>(<span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span>(<span class="kw">tmp_dir</span>, <span class="st">"2015-10-city-of-london-street.csv"</span>)),
        <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span>(<span class="kw">tmp_dir</span>, <span class="st">"2015-10-metropolitan-street.csv"</span>)))
}

<span class="co"># please download the file "crimes_in_Greater_London_2015-10.zip" (available on https://www.jstatsoft.org as a supplement of this paper), and change the path argument below to the location of the downloaded file:</span>
<span class="kw">crimes</span> <span class="op">&lt;-</span> <span class="fu">get_crimes_data</span>(path = <span class="st">"./"</span>)

<span class="co"># create sf of known locations</span>
<span class="kw">crimes</span> <span class="op">&lt;-</span> <span class="kw">crimes</span>[<span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span>(<span class="kw">crimes</span><span class="op">$</span><span class="kw">Longitude</span>) <span class="op">&amp;</span> <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span>(<span class="kw">crimes</span><span class="op">$</span><span class="kw">Latitude</span>), ]
<span class="kw">crimes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/sf/man/st_as_sf.html">st_as_sf</a></span>(<span class="kw">crimes</span>, coords = <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"Longitude"</span>, <span class="st">"Latitude"</span>), crs = <span class="fl">4326</span>)

<span class="co"># set map projection to British National Grid</span>
<span class="kw">crimes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/sf/man/st_transform.html">st_transform</a></span>(<span class="kw">crimes</span>, crs = <span class="fl">27700</span>)

<span class="kw">c1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/qtm.html">qtm</a></span>(<span class="kw">crimes</span>)
<span class="fu"><a href="../reference/tmap_save.html">tmap_save</a></span>(<span class="kw">c1</span>, <span class="st">"crimes1.png"</span>, scale = <span class="fl">.6</span>, width = <span class="fl">3</span>, units = <span class="st">"in"</span>, outer.margins = <span class="fl">0</span>)
</pre></div>
<div class="sourceCode" id="cb13"><pre class="downlit">
<span class="co">#############################</span>
<span class="co">## Figure 12b</span>
<span class="co">#############################</span>
<span class="kw">crimes_osm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/tmaptools/man/read_osm.html">read_osm</a></span>(<span class="kw">crimes</span>)
<span class="kw">c2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/qtm.html">qtm</a></span>(<span class="kw">crimes_osm</span>) <span class="op">+</span> <span class="fu"><a href="../reference/qtm.html">qtm</a></span>(<span class="kw">crimes</span>, symbols.col = <span class="st">"red"</span>, symbols.size = <span class="fl">0.5</span>)
<span class="fu"><a href="../reference/tmap_save.html">tmap_save</a></span>(<span class="kw">c2</span>, <span class="st">"crimes2.jpg"</span>, scale = <span class="fl">.6</span>, width = <span class="fl">3</span>, units = <span class="st">"in"</span>, outer.margins = <span class="fl">0</span>)
</pre></div>
<div class="sourceCode" id="cb14"><pre class="downlit">
<span class="co">#############################</span>
<span class="co">## Figure 13</span>
<span class="co">#############################</span>
<span class="kw">c3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/qtm.html">qtm</a></span>(<span class="kw">crimes_osm</span>, raster.saturation = <span class="fl">0</span>, raster.alpha = <span class="fl">1</span>) <span class="op">+</span> 
  <span class="fu"><a href="../reference/qtm.html">qtm</a></span>(<span class="kw">crimes</span>, symbols.col = <span class="st">"Crime.type"</span>, symbols.size = <span class="fl">0.5</span>) <span class="op">+</span>
  <span class="fu"><a href="../reference/tm_layout.html">tm_legend</a></span>(outside = <span class="fl">TRUE</span>)
<span class="fu"><a href="../reference/tmap_save.html">tmap_save</a></span>(<span class="kw">c3</span>, <span class="st">"crimes3.png"</span>, scale = <span class="fl">.8</span>, width = <span class="fl">5</span>, height = <span class="fl">4</span>, units = <span class="st">"in"</span>, outer.margins = <span class="fl">0</span>)
</pre></div>
<div class="sourceCode" id="cb15"><pre class="downlit">
<span class="co">#############################</span>
<span class="co">## Figure 14</span>
<span class="co">#############################</span>
<span class="kw">regions</span> <span class="op">&lt;-</span> <span class="fu">ne_download</span>(scale = <span class="st">"large"</span>, type = <span class="st">"states"</span>, category = <span class="st">"cultural"</span>, returnclass = <span class="st">"sf"</span>)
<span class="kw">london</span> <span class="op">&lt;-</span> <span class="kw">regions</span>[<span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span>(<span class="kw">regions</span><span class="op">$</span><span class="kw">region</span> <span class="op">==</span> <span class="st">"Greater London"</span>),]
<span class="kw">london</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/sf/man/st_transform.html">st_transform</a></span>(<span class="kw">london</span>, crs = <span class="fl">27700</span>)

<span class="co"># remove crimes outside Greater London</span>
<span class="kw">crimes_london</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/tmaptools/man/crop_shape.html">crop_shape</a></span>(<span class="kw">crimes</span>, <span class="kw">london</span>, polygon =  <span class="fl">TRUE</span>)

<span class="kw">c3b</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/qtm.html">qtm</a></span>(<span class="kw">crimes_london</span>, dots.alpha = <span class="fl">0.1</span>) <span class="op">+</span>
  <span class="fu"><a href="../reference/tm_shape.html">tm_shape</a></span>(<span class="kw">london</span>) <span class="op">+</span> 
  <span class="fu"><a href="../reference/tm_fill.html">tm_borders</a></span>()
<span class="fu"><a href="../reference/tmap_save.html">tmap_save</a></span>(<span class="kw">c3b</span>, <span class="st">"crimes3b.png"</span>, scale = <span class="fl">.7</span>, width = <span class="fl">6.125</span>, units = <span class="st">"in"</span>, outer.margins = <span class="fl">0</span>)
</pre></div>
<div class="sourceCode" id="cb16"><pre class="downlit">
<span class="co">#############################</span>
<span class="co">## Figure 15</span>
<span class="co">#############################</span>
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="st">"devtools"</span>)
<span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html">install_github</a></span>(<span class="st">"mtennekes/oldtmaptools"</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="kw">oldtmaptools</span>)

<span class="kw">crime_densities</span> <span class="op">&lt;-</span> <span class="fu">smooth_map</span>(<span class="kw">crimes_london</span>, bandwidth = <span class="fl">0.5</span>, breaks = <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0</span>, <span class="fl">50</span>, <span class="fl">100</span>, <span class="fl">250</span>, <span class="fl">500</span>, <span class="fl">1000</span>), cover = <span class="kw">london</span>)

<span class="co"># download rivers, and get Thames shape</span>
<span class="kw">rivers</span> <span class="op">&lt;-</span> <span class="fu">ne_download</span>(scale = <span class="st">"large"</span>, type = <span class="st">"rivers_lake_centerlines"</span>, category = <span class="st">"physical"</span>)
<span class="kw">thames</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/tmaptools/man/crop_shape.html">crop_shape</a></span>(<span class="kw">rivers</span>, <span class="kw">london</span>)

<span class="kw">c4</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tm_shape.html">tm_shape</a></span>(<span class="kw">crime_densities</span><span class="op">$</span><span class="kw">polygons</span>) <span class="op">+</span>
  <span class="fu"><a href="../reference/tm_fill.html">tm_fill</a></span>(col = <span class="st">"level"</span>, palette = <span class="st">"YlOrRd"</span>, title = <span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span>(<span class="st">"Crimes per "</span> <span class="op">*</span> <span class="kw">km</span><span class="op">^</span><span class="fl">2</span>)) <span class="op">+</span> 
  <span class="fu"><a href="../reference/tm_shape.html">tm_shape</a></span>(<span class="kw">london</span>) <span class="op">+</span> <span class="fu"><a href="../reference/tm_fill.html">tm_borders</a></span>() <span class="op">+</span>
  <span class="fu"><a href="../reference/tm_shape.html">tm_shape</a></span>(<span class="kw">thames</span>) <span class="op">+</span> <span class="fu"><a href="../reference/tm_lines.html">tm_lines</a></span>(col = <span class="st">"steelblue"</span>, lwd = <span class="fl">4</span>) <span class="op">+</span>
  <span class="fu"><a href="../reference/tm_compass.html">tm_compass</a></span>(position = <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"left"</span>, <span class="st">"bottom"</span>)) <span class="op">+</span>
  <span class="fu"><a href="../reference/tm_scale_bar.html">tm_scale_bar</a></span>(position = <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"left"</span>, <span class="st">"bottom"</span>)) <span class="op">+</span> 
  <span class="fu"><a href="../reference/tm_layout.html">tm_style</a></span>(<span class="st">"gray"</span>, title = <span class="st">"Crimes in Greater London\nOctober 2015"</span>)
<span class="fu"><a href="../reference/tmap_save.html">tmap_save</a></span>(<span class="kw">c4</span>, <span class="st">"crimes4.png"</span>, scale = <span class="fl">.7</span>, width = <span class="fl">6.125</span>, units = <span class="st">"in"</span>, outer.margins = <span class="fl">0</span>)
</pre></div>
<div class="sourceCode" id="cb17"><pre class="downlit">
<span class="co">#############################</span>
<span class="co">## Figure 16</span>
<span class="co">#############################</span>
<span class="kw">london_city</span> <span class="op">&lt;-</span> <span class="kw">london</span>[<span class="kw">london</span><span class="op">$</span><span class="kw">name</span> <span class="op">==</span> <span class="st">"City"</span>,]
<span class="kw">crimes_city</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/tmaptools/man/crop_shape.html">crop_shape</a></span>(<span class="kw">crimes_london</span>, <span class="kw">london_city</span>, polygon = <span class="fl">TRUE</span>)
<span class="kw">london_osm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/tmaptools/man/read_osm.html">read_osm</a></span>(<span class="kw">london_city</span>, type = <span class="st">"stamen-watercolor"</span>, zoom = <span class="fl">13</span>)

<span class="kw">c5</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/qtm.html">qtm</a></span>(<span class="kw">london_osm</span>) <span class="op">+</span>
  <span class="fu"><a href="../reference/tm_shape.html">tm_shape</a></span>(<span class="kw">crimes_city</span>) <span class="op">+</span>
  <span class="fu"><a href="../reference/tm_symbols.html">tm_dots</a></span>(size = <span class="fl">.2</span>) <span class="op">+</span>
  <span class="fu"><a href="../reference/tm_facets.html">tm_facets</a></span>(<span class="st">"Crime.type"</span>, free.coords = <span class="fl">FALSE</span>)
<span class="fu"><a href="../reference/tmap_save.html">tmap_save</a></span>(<span class="kw">c5</span>, <span class="st">"crimes5.png"</span>, scale = <span class="fl">1</span>, width = <span class="fl">6.125</span>, asp = <span class="fl">NA</span>, outer.margins = <span class="fl">0</span>)
</pre></div>
<div class="sourceCode" id="cb18"><pre class="downlit">
<span class="co">#############################</span>
<span class="co">## Figure 17</span>
<span class="co">#############################</span>
<span class="kw">crime_lookup</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"Anti-social behaviour"</span> = <span class="fl">2</span>, 
                  <span class="st">"Bicycle theft"</span> = <span class="fl">1</span>, 
                  <span class="st">"Burglary"</span> = <span class="fl">1</span>,
                  <span class="st">"Criminal damage and arson"</span> = <span class="fl">2</span>,
                  <span class="st">"Drugs"</span> = <span class="fl">6</span>, 
                  <span class="st">"Other crime"</span> = <span class="fl">7</span>,
                  <span class="st">"Other theft"</span> = <span class="fl">1</span>, 
                  <span class="st">"Possession of weapons"</span> = <span class="fl">3</span>, 
                  <span class="st">"Public order"</span> = <span class="fl">2</span>, 
                  <span class="st">"Robbery"</span> = <span class="fl">1</span>, 
                  <span class="st">"Shoplifting"</span> = <span class="fl">1</span>,
                  <span class="st">"Theft from the person"</span> = <span class="fl">1</span>,
                  <span class="st">"Vehicle crime"</span> = <span class="fl">4</span>,
                  <span class="st">"Violence and sexual offences"</span> = <span class="fl">5</span>)
<span class="kw">crime_categories</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"Property Crime"</span>,
                      <span class="st">"Criminal damage and anti-social behaviour"</span>,
                      <span class="st">"Possession of weapons"</span>,
                      <span class="st">"Vehicle crime"</span>,
                      <span class="st">"Violence and sexual offences"</span>,
                      <span class="st">"Drugs"</span>,
                      <span class="st">"Other crime"</span>)
<span class="kw">crimes_city</span><span class="op">$</span><span class="kw">Crime.group</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span>(<span class="kw">crime_lookup</span>[<span class="kw">crimes_city</span><span class="op">$</span><span class="kw">Crime.type</span>], labels = <span class="kw">crime_categories</span>)

<span class="fu"><a href="../reference/tmap_mode.html">tmap_mode</a></span>(<span class="st">"view"</span>)
<span class="fu"><a href="../reference/tm_shape.html">tm_shape</a></span>(<span class="kw">crimes_city</span>) <span class="op">+</span>
  <span class="fu"><a href="../reference/tm_symbols.html">tm_dots</a></span>(jitter = <span class="fl">0.2</span>, col = <span class="st">"Crime.group"</span>, palette = <span class="st">"Dark2"</span>, popup.vars = <span class="fl">TRUE</span>) <span class="op">+</span>
  <span class="fu"><a href="../reference/tm_view.html">tm_view</a></span>(alpha = <span class="fl">1</span>,
    basemaps = <span class="st">"Esri.WorldTopoMap"</span>)
</pre></div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p>Developed by Martijn Tennekes.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.9000.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
