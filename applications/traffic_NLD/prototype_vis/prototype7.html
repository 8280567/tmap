<!DOCTYPE html>
<html>
<head>
	<title>Leaflet Layers Control Example</title>
	<meta charset="utf-8" />

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<!--<script src="http://d3js.org/d3.v3.min.js"></script>-->

	<link rel="stylesheet" href="leaflet_dev/leaflet.css" />

	<style>
		#map {
			width: 700px;
			height: 800px;
			float: left;
		}

		#chart {
			width: auto;
			height: 800px;
			float: left;
		}
		.info {
			padding: 6px 8px;
			font: 14px/16px Arial, Helvetica, sans-serif;
			background: white;
			background: rgba(255,255,255,0.8);
			box-shadow: 0 0 15px rgba(0,0,0,0.2);
			border-radius: 5px;
		}
		.info h4 {
			margin: 0 0 5px;
			color: #777;
		}

		.legend {
			text-align: left;
			line-height: 18px;
			color: #555;
		}
		.legend i {
			width: 18px;
			height: 18px;
			float: left;
			margin-right: 8px;
			opacity: 0.7;
		}
		
		.rect {
			opacity: 0.6
		}
		
		.rect.active {
			opacity: 0.8
		}

	</style>
</head>
<body>
	<div id="map"></div>
    <div id="chart"></div>

	<!--<script src="http://leafletjs.com/dist/leaflet.js"></script>-->
	<script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>
	<script src="leaflet_dev/leaflet.js"></script>
	<script type="text/javascript" src="leaflet.label.js"></script>

	<script type="text/javascript" src="nuts3.js"></script>
	<script type="text/javascript" src="nuts2.js"></script>
	<script type="text/javascript" src="nuts1.js"></script>
	<script type="text/javascript" src="roads.js"></script>
	<script type="text/javascript" src="roadsL.js"></script>
	<script type="text/javascript" src="roadsR.js"></script>
	<script type="text/javascript" src="placesNL.js"></script>
	<script type="text/javascript" src="eu.js"></script>
	
	<script type="text/javascript">

		function style_nuts3(feature) {
			return {
				weight: 1,
				opacity: 1,
				color: '#777777',
				dashArray: '',
				fillOpacity: 1,
				fillColor: 'white'
			};
		}

		function style_nuts2_borders(feature) {
			return {
				weight: 2,
				opacity: 1,
				color: 'black',
				dashArray: '',
				fillOpacity: 0,
				fillColor: '#000000'
			};
		}
		
		function style_roads(feature) {
			return {
				weight: 3,
				opacity: 1,
				color: index2col(feature.properties.x),
				dashArray: ''
			};
		}

		function style_eu(feature) {
			return {
				weight: 1,
				opacity: 1,
				color: 'black',
				dashArray: '',
				fillOpacity: 1,
				fillColor: 'white'
			};
		}
		
		function index2col(d) {
			return d > 80 ? '#B10026' :
			       d > 60  ? '#E31A1C' :
			       d > 40  ? '#FC4E2A' :
			       d > 20  ? '#FD8D3C' :
			                 '#FEB24C';
		}

		
		function highlightFeature_nuts(e) {
			var layer = e.target;

			layer.setStyle({
				weight: 3,
				color: '#666',
				dashArray: '',
				fillOpacity: 0.7
			});

			
			//if (!L.Browser.ie && !L.Browser.opera) {
			//	layer.bringToFront();
			//}

			info_nuts.update(layer.feature.properties);
		}

		function highlightFeature_roads(e) {
			var layer = e.target;

			layer.setStyle({
				weight: 5
			});

			//if (!L.Browser.ie && !L.Browser.opera) {
			//	layer.bringToFront();
			//}

			info_roads.update(layer.feature.properties);
		}

		function resetHighlight_nuts(e) {
			var layer = e.target;

			gnuts3.resetStyle(layer);
			

			info_nuts.update();
		}
		function resetHighlight_roads(e) {
			groads.resetStyle(e.target);
			info_roads.update();
		}

		function zoomToFeature(e) {
			map.fitBounds(e.target.getBounds());
		}

		function onEachFeature_nuts(feature, layer) {
			layer.on({
				//mouseover: highlightFeature_nuts,
				//mouseout: resetHighlight_nuts,
				click: zoomToFeature
			});
		}

		function onEachFeature_roads(feature, layer) {
			layer.on({
				mouseover: highlightFeature_roads,
				mouseout: resetHighlight_roads,
			});
		}
		
	
		gnuts2 = L.geoJson(nuts2, {
			style: style_nuts2_borders,
			name: 'nuts2 layer'
		});

		gnuts3 = L.geoJson(nuts3, {
			style: style_nuts3,
			onEachFeature: onEachFeature_nuts,
			name: 'nuts3 layer'
		});


		groads = L.geoJson(roads, {
			style: style_roads,
			onEachFeature: onEachFeature_roads,
			name: 'roads layer'
		});

		geu = L.geoJson(eu, {
			style: style_eu,
			name: 'eu layer'
		});

		
		var map = L.map('map', {
			center: [52, 5.3],
			zoom: 7,
			minZoom: 7,
			maxZoom: 12,
			maxBounds: [[50.2, 2.3], [54.2, 8.3]],
			layers: [gnuts2, gnuts3, groads]
		});


		var info_roads = L.control();
		
		
		info_roads.onAdd = function (map) {
			this._div = L.DomUtil.create('div', 'info');
			this.update();
			return this._div;
		};
				
		info_roads.update = function (props) {
			this._div.innerHTML = '<h4>Dutch Highway</h4>' +  (props ?
				'<b>' + props.ID + '</b><br />' + 'Region: ' + props.CR_LABEL  + ' (' + props.NUTS3 + ')'
				+ '</b><br />' + 'Score: ' + Math.round(props.x)
				: 'Hover over a road');
		};		
		
		info_roads.addTo(map);


		map.attributionControl.addAttribution('Prototype Traffic Index &copy; <a href="http://www.cbs.nl/">Statistics Netherlands</a>');


		
	</script>


</body>
</html>
