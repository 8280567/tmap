<!DOCTYPE html>
<html>
<head>
	<title>Leaflet Layers Control Example</title>
	<meta charset="utf-8" />

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<!--<script src="http://d3js.org/d3.v3.min.js"></script>-->

	<link rel="stylesheet" href="leaflet/leaflet.css" />

	<style>
		#map {
			width: 700px;
			height: 800px;
		}

		.info {
			padding: 6px 8px;
			font: 14px/16px Arial, Helvetica, sans-serif;
			background: white;
			background: rgba(255,255,255,0.8);
			box-shadow: 0 0 15px rgba(0,0,0,0.2);
			border-radius: 5px;
		}
		.info h4 {
			margin: 0 0 5px;
			color: #777;
		}

		.legend {
			text-align: left;
			line-height: 18px;
			color: #555;
		}
		.legend i {
			width: 18px;
			height: 18px;
			float: left;
			margin-right: 8px;
			opacity: 0.7;
		}


		svg {
			position: relative;
		}
		path {
			fill: #000;
			fill-opacity: .2;
			stroke: #fff;
			stroke-width: 1.5px;
		}
		path:hover {
			fill: brown;
			fill-opacity: .7;
		}
		
	</style>
</head>
<body>
	<div id="map"></div>
	<!--<script src="http://leafletjs.com/dist/leaflet.js"></script>-->
	<script src="leaflet/leaflet.js"></script>
	<script type="text/javascript" src="leaflet.label.js"></script>

	<script type="text/javascript" src="nuts3.js"></script>
	<script type="text/javascript" src="nuts2.js"></script>
	<script type="text/javascript" src="nuts1.js"></script>
	<script type="text/javascript" src="drw_nuts.js"></script>
	<script type="text/javascript" src="nuts_regions.js"></script>



<script src="http://d3js.org/d3.v3.min.js"></script>
<script src="leaflet/leaflet.js"></script>
<script>
	var mbAttr = 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, ' +
			'<a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, ' +
			'Imagery © <a href="http://mapbox.com">Mapbox</a>',
		mbUrl = 'https://{s}.tiles.mapbox.com/v3/{id}/{z}/{x}/{y}.png';

	var land   = L.tileLayer(mbUrl, {id: 'mtennekes.j73fe40m', attribution: mbAttr}),
		grey  = L.tileLayer(mbUrl, {id: 'mtennekes.j816g1eh',   attribution: mbAttr}),
		names  = L.tileLayer(mbUrl, {id: 'mtennekes.j73fih74',   attribution: mbAttr, pane: 'overlayPane'});

	var map = L.map('map', {
		center: [52, 5.3],
		zoom: 7,
		minZoom: 7,
		maxZoom: 12,
		maxBounds: [[50.2, 2.3], [54.2, 8.3]],
		layers: [grey]
	});

		
	var svg = d3.select(map.getPanes().overlayPane).append("svg"),
		g = svg.append("g").attr("class", "leaflet-zoom-hide");
		
	var baseWidth = 700;
	
	var width = 700,
		height = 800,
		centered;

	d3.json("nuts3.geojson", function(collection) {
		var transform = d3.geo.transform({point: projectPoint}),
			path = d3.geo.path().projection(transform);
		
		var feature = g.selectAll("path")
			.data(collection.features)
			.enter().append("path")
			.style("fill", function(d){return d.properties.HCL_color})
			.on("click", clicked2);
			
		map.on("viewreset", reset);
		
		reset();
		
		// Reposition the SVG to cover the features.
		function reset() {
			var bounds = path.bounds(collection),
				topLeft = bounds[0],
				bottomRight = bounds[1];
			svg .attr("width", bottomRight[0] - topLeft[0])
				.attr("height", bottomRight[1] - topLeft[1])
				.style("left", topLeft[0] + "px")
				.style("top", topLeft[1] + "px");
			g .attr("transform", "translate(" + -topLeft[0] + "," + -topLeft[1] + ")");
			feature.attr("d", path);
		}
		// Use Leaflet to implement a D3 geometric transformation.
		function projectPoint(x, y) {
			var point = map.latLngToLayerPoint(new L.LatLng(y, x));
			this.stream.point(point.x, point.y);
		}
	});
	
	function clicked1(d) {
				// getBBox() is a native SVG element method
				var bbox = this.getBBox(),
					centroid = [bbox.x + bbox.width/2, bbox.y + bbox.height/2],
					zoomScaleFactor = baseWidth / bbox.width,
					zoomX = -centroid[0],
					zoomY = -centroid[1];

				// set a transform on the parent group element
				console.log("scale(" + zoomScaleFactor + ")" +
						"translate(" + zoomX + "," + zoomY + ")");
				g.selectAll('path')
					.attr("transform", "scale(" + zoomScaleFactor + ")" +
						"translate(" + zoomX + "," + zoomY + ")");
	}
	
	function clicked2(d) {
		var x, y, k;
		var bbox = this.getBBox();
		if (d && centered !== d) {
			var centroid = [bbox.x + bbox.width/2, bbox.y + bbox.height/2];
			x = centroid[0];
			y = centroid[1];
			k = 4;
			centered = d;
		} else {
			x = width / 2;
			y = height / 2;
			k = 1;
			centered = null;
		}
		 
		g.selectAll("path")
		.classed("active", centered && function(d) { return d === centered; });
		 
		g.transition()
		.duration(750)
		.attr("transform", "translate(" + width / 2 + "," + height / 2 + ")scale(" + k + ")translate(" + -x + "," + -y + ")")
		.style("stroke-width", 1.5 / k + "px");
	}
	
</script>
<script>

</body>
</html>
